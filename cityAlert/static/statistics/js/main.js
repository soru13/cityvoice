/*#BY JESUS EDUARDO MURRIETA ROSAS
#Reposiotrio en github del proyecto 
#github     https://github.com/soru13/GestionDeProyectos*/
// Generated by CoffeeScript 1.4.0
var ajax=(function($){
  var _accion="";
  var _id_Proyecto="";
  var _id_Actividad="";
  var _id_Avance="";
  var _valor="";
  function _GetDataProyecto(){
    $.ajax({
          url: 'GetDataProyectoJson/'+_id_Proyecto,
          type: 'POST',
          success: function(data) {
            $("#id_Proyecto").val(data[0].fields.Proyecto);
            $("#id_Usuario").val(data[0].fields.Usuario);
            $("#id_Estatus").val(data[0].fields.Estatus);
          },
          processData: false,
          contentType: false
      });
  }
  function _GetDataActividad(){
    $.ajax({
          url: '/GetDataActividadJson/'+_id_Actividad,
          type: 'POST',
          success: function(data) {
            $("#id_Actividad").val(data[0].fields.Actividad);
            $("#id_Desde").val(data[0].fields.Desde);
            $("#id_Hasta").val(data[0].fields.Hasta);
            $("#id_Estatus").val(data[0].fields.Estatus);
            $("#id_Proyecto").val(data[0].fields.Proyecto);
            $("#id_Usuario").val(data[0].fields.Usuario);
            $("#id_FechaSolicitud").val(data[0].fields.FechaSolicitud);
            $("#id_Solicitud").val(data[0].fields.Solicitud);
            $(".wysihtml5-sandbox").html(data[0].fields.Observaciones);
            alert(data[0].fields.Observaciones);
          },
          processData: false,
          contentType: false
      });
  }

  function started(){
    $("#leido").on("click", function(){
      $("#myModal").modal("show");
      $.ajax({
          async:true,
              url: '/InBox/',
              type: 'POST',
              success: function(response) {
                if (response.exito) {
                  $("#leido").html('<img src="http://192.168.1.10/static/base/img/inbox-5-24.ico"/>0 Notificaciones');
                  console.log("exito");
                }
              },
        });
    });
    var socket = io.connect("http://192.168.1.10:3000");

    var map = L.map('mimapa', {
        center: [24.803253, -107.389812],
        zoom: 12,
    });

    var tiles = L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png');

    map.addLayer(tiles);

    map.locate({
      enableHighAccuracy: true
    });

    map.on('locationfound', onLocationFound);

    socket.on('coords:user', onReceiveData);

    function onLocationFound(position) {
      console.log(position.latlng);
      var mycoords = position.latlng;
      var marker = L.marker([mycoords.lat, mycoords.lng]);

      map.addLayer(marker);
      marker.bindPopup('Estás aquí');

      socket.emit('coords:me', {latlng: mycoords});
    }

    function onReceiveData(data) {
      console.log(data);
      var coordsUser = data.latlng;
      var marker = L.marker([coordsUser.lat, coordsUser.lng]);

      map.addLayer(marker);
      marker.bindPopup('Estás aquí');
    }
  }





  return{
    inicio:started
  }

})(jQuery);

$(document).on('ready', ajax.inicio );