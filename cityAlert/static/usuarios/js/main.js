/*#BY JESUS EDUARDO MURRIETA ROSAS
#Reposiotrio en github del proyecto 
#github     https://github.com/soru13/GestionDeProyectos*/
// Generated by CoffeeScript 1.4.0
var ajax=(function($){
  function FullDate(id_usuario){
            $("#item"+id_usuario).popover({ placement: 'right', html : true, trigger:'hover'});
            $("#item"+id_usuario).popover('show')
  }
  function started(){

  
    $("#allformulario").show();
    $("#formulario").get(0).reset();
    $('#formulario').bind('submit', function(e) {
      e.preventDefault();
      var accion = $('#formulario').find('input[type=submit]').val();
      console.log(accion);
      var url = accion == 'Agregar' ? '/NuevoUsuarioAjax/':'/EditarUsuarioAjax/';

      var fd = new FormData($('#formulario').get(0));
      if (accion == 'Terminar') {
        var id_usuario = location.href.substr(location.href.lastIndexOf('/')+1);
        fd.append('id_usuario', id_usuario);
      }
      $('#exito').attr({'title':'Usuarios','href':'/Usuarios'});
      $.ajax({
        url: url,
        data: fd,
        type: 'POST',
        beforeSend: function( xhr ) {
          console.log("se enviaron datos");
          console.log(fd);
        },
        success: function(data) {
          if (data.exito) {
            $("#resultados").html("<span class='alert alert-success'>Creado Exitosamente</span>");
            if (accion == 'Agregar') {
              $("#formulario").get(0).reset();
              $("#exito").show();
            };
            if (accion == 'Terminar') {
              $("#exito").show();
            }
          } else {
            $("#resultados").html('');
            if (data.errores.username) {
              $('<span class="alert alert-error"><b>Usuario </b>' + data.errores.username + '</span>').appendTo('#resultados');
            }
            if (data.errores.Usuario) {
              $('<span class="alert alert-error"><b>Usuario </b>' + data.errores.Usuario + '</span>').appendTo('#resultados');
            }
            if (data.errores.password1) {
              $('<span class="alert alert-error"><b>password1 </b>' + data.errores.password1 + '</span>').appendTo('#resultados');
            }
            if (data.errores.password2) {
              $('<span class="alert alert-error"><b>password2 </b>' + data.errores.password2 + '</span>').appendTo('#resultados');
            }
          }
        },
        processData: false,
        contentType: false
      });
    });
  }
  return{
    inicio:started,
    mostrar:FullDate
  }

})(jQuery);
$(document).on('ready', ajax.inicio );
